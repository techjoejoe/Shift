<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leadership Loop Self-Diagnostic - Revised</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: linear-gradient(135deg, #ff8f1c 0%, #ed2024 100%);
            --secondary: linear-gradient(135deg, #323e48 0%, #4a5660 100%);
            --accent: linear-gradient(135deg, #ff8f1c 0%, #ffb366 100%);
            --success: linear-gradient(135deg, #323e48 0%, #5a6670 100%);
            --warning: linear-gradient(135deg, #ed2024 0%, #ff6b6b 100%);
            
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --glass-blur: blur(20px);
            
            --text-primary: #1a1a2e;
            --text-secondary: #16213e;
            --text-light: rgba(255, 255, 255, 0.95);
            --text-muted: rgba(255, 255, 255, 0.7);
            
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-in-out: cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #000000;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 143, 28, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(237, 32, 36, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 50% 20%, rgba(50, 62, 72, 0.3) 0%, transparent 50%);
            color: var(--text-light);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }



        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 143, 28, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(237, 32, 36, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(50, 62, 72, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .floating-orb {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent);
            filter: blur(40px);
            pointer-events: none;
            z-index: 0;
        }

        .orb1 {
            width: 400px;
            height: 400px;
            top: -200px;
            right: -200px;
            animation: float1 20s infinite ease-in-out;
        }

        .orb2 {
            width: 300px;
            height: 300px;
            bottom: -150px;
            left: -150px;
            animation: float2 25s infinite ease-in-out;
        }

        .orb3 {
            width: 250px;
            height: 250px;
            top: 50%;
            left: 50%;
            animation: float3 30s infinite ease-in-out;
        }

        @keyframes float1 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-100px, 100px) rotate(120deg); }
            66% { transform: translate(-50px, -50px) rotate(240deg); }
        }

        @keyframes float2 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(100px, -100px) rotate(-120deg); }
            66% { transform: translate(50px, 50px) rotate(-240deg); }
        }

        @keyframes float3 {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
            position: relative;
            z-index: 2;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            padding: 2.5rem;
            margin-bottom: 2rem;
            transition: all 0.4s var(--ease-out);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.5) 20%,
                rgba(255, 255, 255, 0.5) 80%,
                transparent);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 
                var(--glass-shadow),
                0 20px 40px 0 rgba(31, 38, 135, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        header {
            text-align: center;
            padding: 3rem 2rem;
            position: relative;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ff8f1c 0%, #ed2024 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 143, 28, 0.5);
            animation: glow 3s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .time-estimate {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            font-size: 0.9rem;
            margin-top: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .instructions {
            background: linear-gradient(135deg, rgba(255, 143, 28, 0.1), rgba(237, 32, 36, 0.1));
            backdrop-filter: var(--glass-blur);
            border-left: 4px solid #ff8f1c;
            animation: slideInLeft 0.6s var(--ease-out);
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .instructions h2 {
            font-size: 1.4rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .progress-container {
            position: sticky;
            top: 1rem;
            z-index: 10;
            animation: slideInRight 0.6s var(--ease-out);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff8f1c, #ed2024, #ff8f1c);
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
            transition: width 0.6s var(--ease-out);
            border-radius: 10px;
            position: relative;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 4px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            animation: pulse 1s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .progress-text {
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .section-header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            border-left: 4px solid rgba(102, 126, 234, 0.8);
        }

        .section-header h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .section-description {
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .assessment-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.1));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s var(--ease-out);
            animation: fadeInUp 0.5s var(--ease-out) backwards;
            position: relative;
            overflow: hidden;
        }

        .assessment-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .assessment-item:hover::before {
            opacity: 1;
        }

        .assessment-item:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .assessment-item.error {
            border: 2px solid rgba(250, 112, 154, 0.8);
            background: linear-gradient(135deg, rgba(250, 112, 154, 0.1), rgba(254, 225, 64, 0.1));
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .item-statement {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            color: var(--text-light);
            font-weight: 500;
            line-height: 1.6;
        }

        .likert-scale {
            display: flex;
            gap: 0.75rem;
            justify-content: space-between;
            align-items: stretch;
            border: none;
            background: none;
            padding: 0;
        }

        .likert-option {
            flex: 1;
            position: relative;
        }

        .likert-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .likert-option label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 0.25rem;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s var(--ease-out);
            font-size: 0.75rem;
            min-height: 80px;
            position: relative;
            overflow: hidden;
            text-align: center;
            line-height: 1.2;
        }

        .likert-option label::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3), transparent);
            transform: translate(-50%, -50%);
            transition: all 0.4s var(--ease-out);
            border-radius: 50%;
        }

        .likert-option input[type="radio"]:checked + label::before {
            width: 100%;
            height: 100%;
        }

        .likert-option label:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .likert-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, rgba(255, 143, 28, 0.3), rgba(237, 32, 36, 0.3));
            border-color: #ff8f1c;
            transform: scale(1.05);
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(255, 143, 28, 0.3);
        }

        .likert-option input[type="radio"]:focus + label {
            outline: 3px solid rgba(255, 255, 255, 0.5);
            outline-offset: 2px;
        }

        .likert-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            opacity: 0.5;
            transition: opacity 0.3s ease;
            color: var(--text-light);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .likert-option input[type="radio"]:checked + label .likert-value {
            opacity: 1;
        }

        .forced-choice-item {
            background: linear-gradient(135deg, rgba(50, 62, 72, 0.2), rgba(255, 143, 28, 0.1));
            border: 1px solid rgba(255, 143, 28, 0.3);
        }

        .forced-choice-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .forced-choice-option {
            position: relative;
        }

        .forced-choice-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .forced-choice-option label {
            display: block;
            padding: 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s var(--ease-out);
            line-height: 1.5;
        }

        .forced-choice-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, rgba(255, 143, 28, 0.2), rgba(237, 32, 36, 0.2));
            border: 2px solid #ff8f1c;
            font-weight: 600;
        }

        .forced-choice-option label:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .btn {
            padding: 1rem 3rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s var(--ease-out);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff8f1c 0%, #ed2024 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 143, 28, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 25px rgba(237, 32, 36, 0.5);
        }

        .btn-primary:disabled {
            background: linear-gradient(135deg, rgba(100, 100, 100, 0.5), rgba(80, 80, 80, 0.5));
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .submit-container {
            text-align: center;
            padding: 3rem;
            position: relative;
        }

        .submit-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1), transparent);
            transform: translate(-50%, -50%);
            animation: pulse-bg 3s ease infinite;
        }

        @keyframes pulse-bg {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
        }

        .results-panel {
            display: none;
        }

        /* Results reveal animations */
        @keyframes revealContainer {
            0% {
                opacity: 0;
                filter: blur(10px);
            }
            100% {
                opacity: 1;
                filter: blur(0);
            }
        }

        @keyframes slideInFromBottom {
            0% {
                opacity: 0;
                transform: translateY(100px) scale(0.9);
                filter: blur(5px);
            }
            60% {
                transform: translateY(-10px) scale(1.02);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        @keyframes slideInFromLeft {
            0% {
                opacity: 0;
                transform: translateX(-100px) rotate(-2deg);
            }
            60% {
                transform: translateX(10px) rotate(0.5deg);
            }
            100% {
                opacity: 1;
                transform: translateX(0) rotate(0deg);
            }
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
                border-color: rgba(255, 255, 255, 0.1);
            }
            25% {
                box-shadow: 0 8px 50px 15px rgba(255, 143, 28, 0.4);
                border-color: rgba(255, 143, 28, 0.3);
            }
            50% {
                box-shadow: 0 8px 60px 20px rgba(237, 32, 36, 0.3);
                border-color: rgba(237, 32, 36, 0.3);
            }
            75% {
                box-shadow: 0 8px 50px 15px rgba(255, 143, 28, 0.4);
                border-color: rgba(255, 143, 28, 0.3);
            }
        }

        @keyframes typewriter {
            from {
                width: 0;
            }
            to {
                width: 100%;
            }
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.7) rotateX(20deg);
            }
            50% {
                transform: scale(1.05) rotateX(-5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateX(0deg);
            }
        }

        .results-animated {
            animation: revealContainer 1s ease-out forwards;
        }

        .stage-card-animated {
            opacity: 0;
            animation: slideInFromBottom 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards, pulseGlow 3s ease-in-out infinite;
            transform-origin: center bottom;
            perspective: 1000px;
        }

        .strength-animated {
            opacity: 0;
            animation: slideInFromLeft 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            transform-origin: left center;
        }

        .result-section-animated {
            opacity: 0;
            animation: fadeInScale 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            transform-origin: center center;
            transform-style: preserve-3d;
        }

        .action-buttons-animated {
            opacity: 0;
            animation: slideInFromBottom 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        
        /* Confetti styles */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff8f1c;
            animation: confetti-fall 3s linear forwards;
        }
        
        .confetti:nth-child(odd) {
            width: 8px;
            height: 8px;
            animation-duration: 2.5s;
        }
        
        .confetti:nth-child(3n) {
            width: 6px;
            height: 6px;
            animation-duration: 3.5s;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        @keyframes confetti-sway {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(50px);
            }
        }

        .stage-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.12));
            border-left: 5px solid;
            border-image: linear-gradient(135deg, #667eea, #764ba2) 1;
            position: relative;
            overflow: hidden;
        }

        .stage-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .stage-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .stage-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, rgba(255, 255, 255, 0.8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stage-badge {
            display: inline-block;
            padding: 0.8rem 2rem;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            min-width: 180px;
            text-align: center;
        }

        .stage-badge.primary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.5), rgba(118, 75, 162, 0.5));
        }

        .stage-badge.secondary {
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.5), rgba(71, 85, 105, 0.5));
        }

        .stage-badge.strong {
            background: linear-gradient(135deg, #ed2024, #ff8f1c);
            color: white;
            font-size: 1.3rem;
            padding: 1rem 2.5rem;
            box-shadow: 0 6px 30px rgba(237, 32, 36, 0.5);
            animation: pulse 2s infinite;
        }

        .stage-badge.moderate {
            background: linear-gradient(135deg, #ffb366, #ff8f1c);
            color: white;
            font-size: 1.2rem;
            padding: 0.9rem 2.2rem;
            box-shadow: 0 5px 25px rgba(255, 143, 28, 0.4);
        }

        .stage-badge.low {
            background: linear-gradient(135deg, #5a6670, #323e48);
            color: white;
            font-size: 1.1rem;
            padding: 0.8rem 2rem;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .score-display {
            margin-top: 1rem;
        }

        .stage-description {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-style: italic;
            position: relative;
            z-index: 1;
        }
        
        .interpretation-guide {
            background: linear-gradient(135deg, rgba(50, 62, 72, 0.3), rgba(255, 255, 255, 0.1));
            border: 2px solid rgba(255, 143, 28, 0.3);
            animation: slideInFromBottom 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            max-width: 800px;
            margin: 0 auto 2rem;
        }
        
        .guide-section {
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 8px;
        }

        .result-section {
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 1;
        }

        .result-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .result-section h3::before {
            content: '';
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.5), rgba(118, 75, 162, 0.5));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .trap-warning {
            background: linear-gradient(135deg, rgba(237, 32, 36, 0.15), rgba(50, 62, 72, 0.15));
            border-left: 4px solid #ed2024;
            padding: 1.25rem 1.5rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .shift-emphasis {
            background: linear-gradient(135deg, rgba(255, 143, 28, 0.15), rgba(50, 62, 72, 0.15));
            padding: 1.5rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 143, 28, 0.3);
        }

        .checklist {
            list-style: none;
        }

        .checklist li {
            padding: 1rem;
            padding-left: 3rem;
            position: relative;
            margin-bottom: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .checklist li:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .checklist li::before {
            content: '‚úì';
            position: absolute;
            left: 1rem;
            font-size: 1.3rem;
            font-weight: bold;
            background: linear-gradient(135deg, #ff8f1c, #ed2024);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .top-items {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            list-style: none;
        }

        .top-items li {
            margin: 0.75rem 0;
            padding-left: 0;
            position: relative;
        }

        .chart-container {
            position: relative;
            overflow: hidden;
        }

        .chart-container h3 {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            background: linear-gradient(135deg, #fff, rgba(255, 255, 255, 0.7));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 250px;
            padding: 0 1rem;
        }

        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 80px;
            position: relative;
        }

        .bar {
            width: 50px;
            border-radius: 10px 10px 0 0;
            position: relative;
            transition: all 0.5s var(--ease-out);
            min-height: 20px;
            animation: growBar 1s var(--ease-out) backwards;
            cursor: pointer;
        }

        @keyframes growBar {
            from {
                height: 0 !important;
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .bar:hover {
            transform: scaleY(1.05);
            filter: brightness(1.2);
        }

        .bar-value {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-light);
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .bar-label {
            margin-top: 1rem;
            font-size: 0.8rem;
            text-align: center;
            color: var(--text-muted);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            padding: 2rem;
        }

        footer {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .confidentiality-note {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            max-width: 600px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .strength-feedback {
            background: linear-gradient(135deg, rgba(50, 62, 72, 0.2), rgba(255, 255, 255, 0.05));
            border-left: 4px solid #323e48;
            padding: 1.25rem 1.5rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            margin-bottom: 2rem;
        }

        .strength-feedback h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        .strength-list {
            list-style: none;
        }

        .strength-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .strength-list li::before {
            content: '‚ú®';
            position: absolute;
            left: 0;
            font-size: 1.2rem;
        }

        .tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: help;
            margin-left: 0.5rem;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .tooltip:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            text-align: center;
            padding: 0.75rem;
            border-radius: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.875rem;
            backdrop-filter: blur(10px);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        @media print {
            body {
                background: white;
            }
            
            * {
                color: black !important;
                background: white !important;
                -webkit-text-fill-color: black !important;
            }
            
            .btn, .action-buttons, .floating-orb {
                display: none !important;
            }
            
            .glass-card {
                border: 1px solid #ddd;
                box-shadow: none;
            }
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .likert-scale {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .likert-option {
                width: 100%;
            }
            
            .likert-option label {
                padding: 1rem;
                min-height: auto;
                flex-direction: row;
                justify-content: space-between;
            }
            
            .chart-bars {
                height: 250px;
                gap: 0.5rem;
            }
            
            .bar {
                width: 100%;
                max-width: 40px;
            }
            
            .bar-value {
                font-size: 0.9rem;
                padding: 2px 4px;
            }
            
            .bar-label {
                font-size: 0.65rem;
            }
            
            .forced-choice-options {
                gap: 0.75rem;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="floating-orb orb1"></div>
    <div class="floating-orb orb2"></div>
    <div class="floating-orb orb3"></div>
    
    <div class="container">
        <header class="glass-card">
            <h1>Leadership Loop<br>Self-Diagnostic</h1>
            <div class="time-estimate">
                <span>‚è±Ô∏è</span>
                <span>8-10 minutes</span>
            </div>
        </header>

        <div class="instructions glass-card">
            <h2>Instructions</h2>
            <p>Think about your behavior over the last 30-60 days. Rate how often each statement describes you.</p>
        </div>

        <div class="progress-container glass-card">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0/32 questions answered</div>
        </div>

        <form class="assessment-form" id="assessmentForm">
            <!-- Assessment items will be dynamically inserted here -->
        </form>

        <div class="submit-container">
            <button type="button" class="btn btn-primary" id="submitBtn" disabled>
                <span>Submit Assessment</span>
                <span>‚Üí</span>
            </button>
        </div>

        <div class="results-panel" id="resultsPanel">
            <!-- Results will be dynamically inserted here -->
        </div>

        <footer>
            <div class="confidentiality-note glass-card">
                <strong>üîí Confidentiality Note:</strong> Your responses are stored locally in your browser and are not transmitted to any server. You can clear your data at any time using the Reset button.
            </div>
        </footer>
    </div>

    <script>
        // Stage definitions with updated names and items
        const stages = {
            Pleasing: {
                displayName: "Pleasing",
                definition: "Avoiding conflict and softening expectations to maintain comfort.",
                trap: "Unclear expectations lead to confusion and rework.",
                shift: "Set Context + Hear Fully: anchor to purpose, then invite open dialogue.",
                suggestedReading: {
                    title: "Addressing The Crisis Of Leadership Character",
                    source: "Forbes",
                    url: "https://www.forbes.com/sites/marycrossan/2025/02/28/addressing-the-crisis-of-leadership-character/",
                    description: "This article explores the importance of character-based leadership and the courage required to maintain standards even when it's uncomfortable."
                },
                behaviorExamples: [
                    "Saying 'whenever you get a chance' instead of giving clear deadlines",
                    "Apologizing when following up on overdue deliverables",
                    "Accepting subpar work to avoid difficult conversations",
                    "Changing agreed standards when someone seems stressed",
                    "Taking work back rather than addressing performance issues"
                ],
                workplaceScenario: "When a project deadline approaches and quality issues emerge, you find yourself doing the work yourself at night rather than having a direct conversation about standards. Team members learn they can deliver late or incomplete work because you'll either fix it or extend deadlines.",
                items: [
                    { text: "I soften or remove deadlines to keep my team comfortable, even when commitments are clear.", reverse: false },
                    { text: "I clearly communicate non-negotiable standards, even if it may cause discomfort.", reverse: true },
                    { text: "I apologize when enforcing commitments that we already agreed to.", reverse: false },
                    { text: "I adjust expectations when appropriate but avoid lowering standards just to reduce discomfort.", reverse: true }
                ]
            },
            "Over-Involved": {
                displayName: "Over-Involved (Grinding)",
                definition: "Doing tasks yourself instead of developing the team.",
                trap: "Team never grows; you become the bottleneck.",
                shift: "Invite Ownership: define skills/resources and hand over responsibility.",
                suggestedReading: {
                    title: "Heroes Vs. Leaders",
                    source: "Forbes",
                    url: "https://www.forbes.com/sites/hillennevins/2021/11/21/heroes-vs-leaders/",
                    description: "Learn the critical difference between being a hero who does everything and a leader who develops others to succeed independently."
                },
                behaviorExamples: [
                    "Jumping into Slack threads to answer questions meant for team members",
                    "Redoing presentations instead of providing feedback",
                    "Attending meetings your team could handle alone",
                    "Writing the first draft 'to give them a starting point'",
                    "Solving problems during 1:1s instead of coaching through them"
                ],
                workplaceScenario: "Your calendar is packed with 'quick reviews' and you're constantly in the weeds on technical details. Meanwhile, your team waits for your input on everything, their skills atrophy, and you wonder why no one takes initiative. You're exhausted but feel you can't step back.",
                items: [
                    { text: "I take over tasks my team members could reasonably complete themselves.", reverse: false },
                    { text: "I delegate full ownership of outcomes, not just isolated tasks.", reverse: true },
                    { text: "I give direct answers instead of coaching team members to solve problems on their own.", reverse: false },
                    { text: "When team members' work meets agreed standards, I accept it without imposing my personal style.", reverse: true }
                ]
            },
            Micromanaging: {
                displayName: "Micromanaging (Aligning)",
                definition: "Controlling both outcomes and methods too tightly.",
                trap: "Team can't act without your approval; innovation stalls.",
                shift: "Frame Actions: co-create plans with embedded decision rights.",
                suggestedReading: {
                    title: "Why The Best Leaders Turn Rethinking Into A Competitive Advantage",
                    source: "Forbes",
                    url: "https://www.forbes.com/sites/paolacecchi-dimeglio/2025/03/06/how-the-best-leaders-turn-rethinking-into-a-competitive-advantage/",
                    description: "Discover how letting go of control and empowering teams to think differently creates competitive advantage through innovation."
                },
                behaviorExamples: [
                    "Prescribing exact email templates for team communications",
                    "Requiring approval for routine decisions within their scope",
                    "Dictating specific tools or methods when alternatives would work",
                    "Reviewing work at every step rather than at milestones",
                    "Correcting style preferences that don't impact outcomes"
                ],
                workplaceScenario: "Your team sends you drafts of drafts, asks permission for minor decisions, and waits for your review before proceeding to next steps. Innovation has stopped because everyone follows your exact playbook. Projects move slowly as everything bottlenecks through your approvals.",
                items: [
                    { text: "I dictate both the outcome and the exact steps team members must follow.", reverse: false },
                    { text: "When a method is required, I explain the reason and give team members autonomy within clear constraints.", reverse: true },
                    { text: "I require my approval for decisions that team members could responsibly make themselves.", reverse: false },
                    { text: "I empower team members to make decisions within clear boundaries when I delegate work.", reverse: true }
                ]
            },
            "Over-Indexed": {
                displayName: "Over-Indexed on Results (Driving)",
                definition: "Pushing for speed while staying in the middle of decisions.",
                trap: "Execution speed limited by your constant involvement.",
                shift: "Track Progress: empower action without being a bottleneck.",
                suggestedReading: {
                    title: "Getting Focused on Results",
                    source: "Harvard Business Review",
                    url: "https://hbr.org/2007/11/getting-focused-on-results",
                    description: "Learn how to drive results through systems and empowerment rather than constant personal involvement in execution."
                },
                behaviorExamples: [
                    "Asking for daily updates on weekly deliverables",
                    "Joining meetings to 'help move things along'",
                    "Taking over parts of projects to maintain momentum",
                    "Creating urgency without considering sustainable pace",
                    "Measuring activity metrics instead of outcomes"
                ],
                workplaceScenario: "Every project feels urgent, and you're constantly checking in to 'remove blockers' that often means doing part of the work yourself. The team feels pressured but paradoxically slower because they wait for your involvement. Burnout is rising while actual delivery speed decreases.",
                items: [
                    { text: "I request frequent updates, sometimes at the expense of my team's focus.", reverse: false },
                    { text: "I anchor check-ins on milestones and outcomes rather than daily activity reports.", reverse: true },
                    { text: "I step in to remove obstacles when requested by the team.", reverse: true },
                    { text: "I take over parts of my team's work to keep projects on pace.", reverse: false }
                ]
            },
            "Over-Reliance": {
                displayName: "Over-Reliance on Heroes (Shaping)",
                definition: "Clear vision but weak systems to deliver consistently.",
                trap: "Success depends on individual heroics rather than processes.",
                shift: "Build systems: create repeatable processes and support structures.",
                suggestedReading: {
                    title: "Stop Being The Hero Leader: Why Great Teams Need Less Leadership",
                    source: "Forbes",
                    url: "https://www.forbes.com/sites/keithferrazzi/2025/01/31/stop-being-the-hero-leader-why-great-teams-need-less-leadership/",
                    description: "Understand why relying on heroic efforts undermines team capability and learn how to build systems that enable consistent success."
                },
                behaviorExamples: [
                    "Relying on star performers to figure things out",
                    "Celebrating heroic efforts instead of building prevention",
                    "Having undocumented processes that live in people's heads",
                    "Different team members achieving wildly different results",
                    "Knowledge concentrated in a few key individuals"
                ],
                workplaceScenario: "Your team succeeds through extraordinary individual efforts and late nights. When your top performer is on vacation, projects stall. New team members struggle because there's no clear process to follow. Success feels fragile and person-dependent rather than systematic.",
                items: [
                    { text: "I share direction but do not put in place the systems needed for consistent execution.", reverse: false },
                    { text: "I ensure there are documented workflows and tools so people can execute without me.", reverse: true },
                    { text: "My team's success depends more on ad-hoc individual effort than on consistent systems.", reverse: false },
                    { text: "I standardize successful practices so outcomes are repeatable across people.", reverse: true }
                ]
            },
            "Clarity-Drift": {
                displayName: "Clarity & Accountability Drift (Building)",
                definition: "Systems exist but drift without reinforcement.",
                trap: "Long-term ownership decays; standards become inconsistent.",
                shift: "Track Progress + Invite Ownership: reinforce expectations regularly.",
                suggestedReading: {
                    title: "Today's Most Crucial Leadership Skill Is Systems Thinking",
                    source: "Forbes",
                    url: "https://www.forbes.com/sites/maryjohnstone-louis/2025/04/25/todays-most-crucial-leadership-skill-is-systems-thinking/",
                    description: "Explore how systems thinking helps maintain clarity and accountability over time, preventing the drift that undermines team performance."
                },
                behaviorExamples: [
                    "Assuming everyone remembers decisions from months ago",
                    "Not revisiting role clarity as the team evolves",
                    "Letting process exceptions become the new normal",
                    "Forgetting to celebrate wins that reinforce standards",
                    "Ownership boundaries becoming fuzzy over time"
                ],
                workplaceScenario: "What started as clear roles and processes has slowly eroded. Team members aren't sure who owns what anymore, standards vary by person, and you find yourself repeatedly clarifying expectations you thought were established. The strong foundation you built is crumbling from lack of maintenance.",
                items: [
                    { text: "Ownership of responsibilities becomes unclear unless I frequently step in to remind people.", reverse: false },
                    { text: "My team shares a current and common understanding of roles and standards.", reverse: true },
                    { text: "Established expectations tend to drift over time unless I re-clarify them.", reverse: false },
                    { text: "Accountability systems continue to work without my daily oversight.", reverse: true }
                ]
            }
        };

        // Forced-choice scenarios
        const forcedChoiceScenarios = [
            {
                scenario: "A team member requests a deadline extension on a project with firm delivery requirements:",
                options: [
                    { text: "I explore alternatives while keeping the original deadline.", maps_to: "Micromanaging" },
                    { text: "I grant the extension to reduce stress, even if deadlines slip.", maps_to: "Pleasing" }
                ]
            },
            {
                scenario: "I notice a team member using an inefficient approach that will still achieve the outcome:",
                options: [
                    { text: "I intervene and show the more efficient method so progress is faster.", maps_to: "Over-Involved" },
                    { text: "I let them finish and discuss optimization later, even if it takes longer now.", maps_to: "Over-Reliance" }
                ]
            },
            {
                scenario: "A team member asks for guidance on a decision they have authority to make:",
                options: [
                    { text: "I provide the decision directly to keep the business moving forward.", maps_to: "Over-Indexed" },
                    { text: "I ask questions so they reach their own conclusion, even if it takes more time.", maps_to: "Micromanaging" }
                ]
            },
            {
                scenario: "I am launching a new process the team must adopt:",
                options: [
                    { text: "I implement quickly and adjust as we go to avoid delay.", maps_to: "Over-Indexed" },
                    { text: "I first create clear documentation and training before rollout to ensure consistency.", maps_to: "Over-Reliance" }
                ]
            }
        ];

        // Application state
        let assessmentData = {};
        let forcedChoiceData = {};
        let itemOrder = [];
        const totalLikertItems = 24;
        const totalForcedChoiceItems = 4;
        const totalItems = totalLikertItems + totalForcedChoiceItems;
        
        // Initialize the application
        function init() {
            loadState();
            createAssessmentItems();
            updateProgress();
            attachEventListeners();
            addAnimationDelays();
        }

        // Add animation delays to assessment items
        function addAnimationDelays() {
            const items = document.querySelectorAll('.assessment-item');
            items.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.05}s`;
            });
        }

        // Create and randomize assessment items
        function createAssessmentItems() {
            const form = document.getElementById('assessmentForm');
            
            // Check if we have a saved order
            const saved = localStorage.getItem('leadershipAssessmentRevised');
            let savedOrder = null;
            
            if (saved) {
                const data = JSON.parse(saved);
                savedOrder = data.itemOrder;
            }
            
            if (savedOrder && savedOrder.length > 0) {
                // Use the saved order
                itemOrder = savedOrder;
            } else {
                // Create new randomized order
                const allItems = [];
                
                // Collect all Likert items with their stage mapping
                Object.entries(stages).forEach(([stageName, stageData]) => {
                    stageData.items.forEach((item, index) => {
                        allItems.push({
                            text: item.text,
                            stage: stageName,
                            originalIndex: index,
                            reverse: item.reverse,
                            id: `${stageName}_${index}` // Add unique identifier
                        });
                    });
                });
                
                // Randomize Likert items
                itemOrder = allItems.sort(() => Math.random() - 0.5);
            }
            
            // Add section header for Likert items
            const likertHeader = document.createElement('div');
            likertHeader.className = 'section-header glass-card';
            likertHeader.innerHTML = `
                <h3>Part 1: Behavioral Frequency</h3>
                <p class="section-description">Rate how often each statement describes your behavior over the last 30-60 days.</p>
            `;
            form.appendChild(likertHeader);
            
            // Create HTML for each Likert item
            itemOrder.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'assessment-item';
                itemDiv.dataset.index = index;
                itemDiv.dataset.stage = item.stage;
                itemDiv.dataset.reverse = item.reverse;
                
                itemDiv.innerHTML = `
                    <div class="item-statement">
                        ${item.text}
                    </div>
                    <fieldset class="likert-scale" role="radiogroup" aria-labelledby="item-${index}-label">
                        <legend class="sr-only" id="item-${index}-label">${item.text}</legend>
                        ${createLikertOptions(index)}
                    </fieldset>
                `;
                
                form.appendChild(itemDiv);
            });
            
            // Add section header for forced-choice items
            const forcedHeader = document.createElement('div');
            forcedHeader.className = 'section-header glass-card';
            forcedHeader.style.marginTop = '3rem';
            forcedHeader.innerHTML = `
                <h3>Part 2: Decision Scenarios</h3>
                <p class="section-description">Choose the option that best describes how you would typically respond.</p>
            `;
            form.appendChild(forcedHeader);
            
            // Create forced-choice scenarios
            forcedChoiceScenarios.forEach((scenario, index) => {
                const scenarioDiv = document.createElement('div');
                scenarioDiv.className = 'assessment-item forced-choice-item';
                scenarioDiv.dataset.forcedIndex = index;
                
                scenarioDiv.innerHTML = `
                    <div class="item-statement">
                        ${scenario.scenario}
                    </div>
                    <fieldset class="forced-choice-options" role="radiogroup" aria-labelledby="forced-${index}-label">
                        <legend class="sr-only" id="forced-${index}-label">${scenario.scenario}</legend>
                        ${createForcedChoiceOptions(scenario, index)}
                    </fieldset>
                `;
                
                form.appendChild(scenarioDiv);
            });
        }

        // Create Likert scale options
        function createLikertOptions(itemIndex) {
            const options = [
                { value: 1, label: 'Not at all\nlike this', icon: '1' },
                { value: 2, label: 'To some\nextent', icon: '2' },
                { value: 3, label: 'To a moderate\nextent', icon: '3' },
                { value: 4, label: 'To a great\nextent', icon: '4' },
                { value: 5, label: 'Best\ndescribes me', icon: '5' }
            ];
            
            return options.map(option => `
                <div class="likert-option">
                    <input type="radio" 
                           id="item-${itemIndex}-${option.value}" 
                           name="item-${itemIndex}" 
                           value="${option.value}"
                           aria-label="${option.label.replace(/\n/g, ' ')}">
                    <label for="item-${itemIndex}-${option.value}">
                        <span class="likert-value">${option.icon}</span>
                        <span style="white-space: pre-line;">${option.label}</span>
                    </label>
                </div>
            `).join('');
        }

        // Create forced-choice options
        function createForcedChoiceOptions(scenario, scenarioIndex) {
            return scenario.options.map((option, optionIndex) => `
                <div class="forced-choice-option">
                    <input type="radio" 
                           id="forced-${scenarioIndex}-${optionIndex}" 
                           name="forced-${scenarioIndex}" 
                           value="${option.maps_to}"
                           data-text="${option.text}">
                    <label for="forced-${scenarioIndex}-${optionIndex}">
                        ${String.fromCharCode(65 + optionIndex)}. ${option.text}
                    </label>
                </div>
            `).join('');
        }

        // Attach event listeners
        function attachEventListeners() {
            // Form change events
            document.getElementById('assessmentForm').addEventListener('change', (e) => {
                if (e.target.type === 'radio') {
                    const itemDiv = e.target.closest('.assessment-item');
                    
                    if (itemDiv.dataset.index !== undefined) {
                        // Likert item
                        const index = itemDiv.dataset.index;
                        const value = parseInt(e.target.value);
                        const isReverse = itemDiv.dataset.reverse === 'true';
                        
                        // Apply reverse scoring if needed
                        const scoredValue = isReverse ? (6 - value) : value;
                        
                        assessmentData[index] = {
                            raw: value,
                            scored: scoredValue,
                            reverse: isReverse
                        };
                        
                        itemDiv.classList.remove('error');
                    } else if (itemDiv.dataset.forcedIndex !== undefined) {
                        // Forced-choice item
                        const index = itemDiv.dataset.forcedIndex;
                        forcedChoiceData[index] = e.target.value;
                        itemDiv.classList.remove('error');
                    }
                    
                    saveState();
                    updateProgress();
                    
                    // Add haptic-like visual feedback
                    itemDiv.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        itemDiv.style.transform = '';
                    }, 200);
                }
            });
            
            // Submit button
            document.getElementById('submitBtn').addEventListener('click', submitAssessment);
        }

        // Update progress bar
        function updateProgress() {
            const answeredLikert = Object.keys(assessmentData).length;
            const answeredForced = Object.keys(forcedChoiceData).length;
            const answered = answeredLikert + answeredForced;
            const percentage = (answered / totalItems) * 100;
            
            document.getElementById('progressFill').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${answered}/${totalItems} questions answered`;
            
            const submitBtn = document.getElementById('submitBtn');
            if (answered === totalItems) {
                submitBtn.disabled = false;
                submitBtn.classList.add('pulse');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.remove('pulse');
            }
        }

        // Submit assessment
        function submitAssessment() {
            // Validate all items are answered
            const allLikertAnswered = itemOrder.every((_, index) => assessmentData[index] !== undefined);
            const allForcedAnswered = forcedChoiceScenarios.every((_, index) => forcedChoiceData[index] !== undefined);
            
            if (!allLikertAnswered || !allForcedAnswered) {
                // Highlight unanswered items
                itemOrder.forEach((_, index) => {
                    if (assessmentData[index] === undefined) {
                        const item = document.querySelector(`[data-index="${index}"]`);
                        item.classList.add('error');
                        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
                
                forcedChoiceScenarios.forEach((_, index) => {
                    if (forcedChoiceData[index] === undefined) {
                        const item = document.querySelector(`[data-forced-index="${index}"]`);
                        item.classList.add('error');
                        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
                return;
            }
            
            // Create confetti celebration!
            createConfetti();
            
            // Calculate scores after a short delay for effect
            setTimeout(() => {
                const scores = calculateScores();
                const results = analyzeResults(scores);
                
                // Display results
                displayResults(results);
                
                // Smooth scroll to results
                setTimeout(() => {
                    document.getElementById('resultsPanel').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }, 800);
        }
        
        // Create confetti effect
        function createConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);
            
            const colors = ['#ff8f1c', '#ed2024', '#ffb366', '#323e48', '#ff6b6b', '#5a6670', '#ffffff'];
            const confettiCount = 150;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.animationDuration = (Math.random() * 1.5 + 2) + 's';
                
                // Random shapes
                if (Math.random() > 0.5) {
                    confetti.style.borderRadius = '50%';
                } else {
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                }
                
                container.appendChild(confetti);
            }
            
            // Remove confetti after animation completes
            setTimeout(() => {
                container.remove();
            }, 4000);
        }

        // Calculate scores by stage
        function calculateScores() {
            const scores = {};
            Object.keys(stages).forEach(stage => {
                scores[stage] = 0;
            });
            
            // Add Likert scores (using scored values)
            itemOrder.forEach((item, index) => {
                if (assessmentData[index]) {
                    scores[item.stage] += assessmentData[index].scored;
                }
            });
            
            // Add forced-choice scores (each adds 2 points to the selected stage)
            Object.values(forcedChoiceData).forEach(stageName => {
                if (scores[stageName] !== undefined) {
                    scores[stageName] += 2;
                }
            });
            
            return scores;
        }

        // Analyze results to find primary and secondary stages
        function analyzeResults(scores) {
            const sortedStages = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            
            const primary = {
                stage: sortedStages[0][0],
                score: sortedStages[0][1],
                maxScore: 28 // 20 from Likert (4 items √ó 5 max) + 8 potential from forced-choice
            };
            
            const secondary = {
                stage: sortedStages[1][0],
                score: sortedStages[1][1],
                maxScore: 28
            };
            
            // Check for ties
            const isTie = primary.score === secondary.score;
            
            // Get strength labels
            primary.strength = getStrengthLabel(primary.score, primary.maxScore);
            secondary.strength = getStrengthLabel(secondary.score, secondary.maxScore);
            
            // Identify strengths (low scores indicate good practices)
            const strengths = identifyStrengths(scores);
            
            // Get top items for primary stage
            const topItems = getTopItemsForStage(primary.stage);
            
            return {
                primary,
                secondary,
                isTie,
                scores,
                topItems,
                strengths,
                timestamp: new Date().toISOString()
            };
        }

        // Get strength label based on score
        function getStrengthLabel(score, maxScore) {
            const percentage = (score / maxScore) * 100;
            if (percentage >= 60) return 'strong';
            if (percentage >= 40) return 'moderate';
            return 'low';
        }

        // Identify strengths (stages with low scores)
        function identifyStrengths(scores) {
            const strengths = [];
            const sortedStages = Object.entries(scores).sort((a, b) => a[1] - b[1]);
            
            // Consider the bottom 2 stages as strengths if their scores are low enough
            sortedStages.slice(0, 2).forEach(([stageName, score]) => {
                const percentage = (score / 28) * 100;
                if (percentage < 40) {
                    const stage = stages[stageName];
                    strengths.push({
                        stage: stageName,
                        displayName: stage.displayName,
                        score: score,
                        description: getStrengthDescription(stageName)
                    });
                }
            });
            
            return strengths;
        }

        // Get strength description for a stage
        function getStrengthDescription(stageName) {
            const descriptions = {
                'Pleasing': 'You maintain clear standards without compromising for comfort',
                'Over-Involved': 'You delegate effectively and let your team own their work',
                'Micromanaging': 'You provide autonomy within clear boundaries',
                'Over-Indexed': 'You balance urgency with sustainable team practices',
                'Over-Reliance': 'You build robust systems that support consistent execution',
                'Clarity-Drift': 'You maintain accountability systems that work independently'
            };
            return descriptions[stageName] || 'Strong leadership practices in this area';
        }

        // Get top-rated items for a stage
        function getTopItemsForStage(stageName) {
            const stageItems = itemOrder
                .map((item, index) => ({
                    ...item,
                    rating: assessmentData[index]?.scored || 0
                }))
                .filter(item => item.stage === stageName && !item.reverse) // Focus on problem behaviors
                .sort((a, b) => b.rating - a.rating)
                .slice(0, 3);
            
            return stageItems.map(item => item.text);
        }

        // Display results
        function displayResults(results) {
            const resultsPanel = document.getElementById('resultsPanel');
            const primaryStage = stages[results.primary.stage];
            const secondaryStage = stages[results.secondary.stage];
            
            let html = '<div class="results-animated">';
            
            // Add interpretation guide first
            html += `
                <div class="interpretation-guide glass-card" style="animation-delay: 0.2s;">
                    <h2 style="font-size: 1.8rem; margin-bottom: 1.5rem; text-align: center;">
                        üìä How to Read Your Results
                    </h2>
                    
                    <div style="display: grid; gap: 1.5rem;">
                        <div class="guide-section">
                            <h3 style="color: #ff8f1c; margin-bottom: 0.5rem;">What You'll See:</h3>
                            <p>Your results show which leadership patterns you use most often. We all have these patterns - they're not good or bad, just habits that might be holding you back.</p>
                        </div>
                        
                        <div class="guide-section">
                            <h3 style="color: #ff8f1c; margin-bottom: 0.5rem;">Your Score Means:</h3>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-left: 1rem;">
                                <div><strong style="color: #ed2024;">STRONG (17-28):</strong> This pattern shows up a lot. It's probably affecting your team daily.</div>
                                <div><strong style="color: #ff8f1c;">MODERATE (12-16):</strong> You do this sometimes. It's worth watching.</div>
                                <div><strong style="color: #5a6670;">LOW (4-11):</strong> You rarely do this. That's actually a strength!</div>
                            </div>
                        </div>
                        
                        <div class="guide-section">
                            <h3 style="color: #ff8f1c; margin-bottom: 0.5rem;">Focus on Your Primary Area:</h3>
                            <p>Your "Primary Focus Area" is where small changes will make the biggest difference. Don't try to fix everything - just focus on this one area for the next month.</p>
                        </div>
                        
                        <div class="guide-section" style="background: rgba(255, 143, 28, 0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid #ff8f1c;">
                            <p style="margin: 0; font-weight: 600;">üí° Remember: Every leader has these patterns. Knowing yours is the first step to breaking free from them.</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-secondary" onclick="showResults()" style="background: linear-gradient(135deg, #ff8f1c, #ed2024); border: none;">
                            Got It! Show My Results ‚Üí
                        </button>
                    </div>
                </div>
            `;
            
            // Store results content but don't show yet
            let resultsContent = '';
            
            // Strengths section (if any)
            if (results.strengths.length > 0) {
                resultsContent += `
                    <div class="strength-feedback glass-card strength-animated" style="animation-delay: 0.3s;">
                        <h3>üåü Your Leadership Strengths</h3>
                        <p style="margin-bottom: 1rem;">These areas show mature leadership practices:</p>
                        <ul class="strength-list">
                            ${results.strengths.map(strength => 
                                `<li><strong>${strength.displayName}:</strong> ${strength.description}</li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Primary stage card
            resultsContent += `
                <div class="stage-card glass-card stage-card-animated" style="animation-delay: 0.6s;">
                    <div class="stage-header">
                        <h2 class="stage-title">Primary Focus Area: ${primaryStage.displayName}</h2>
                        <div class="score-display">
                            <span class="stage-badge ${results.primary.strength}">
                                ${results.primary.strength.toUpperCase()} ${results.primary.score}/${results.primary.maxScore}
                            </span>
                        </div>
                    </div>
                    
                    <p class="stage-description">${primaryStage.definition}</p>
                    
                    <div class="result-section result-section-animated" style="animation-delay: 0.9s;">
                        <h3>What This Looks Like</h3>
                        <p style="margin-bottom: 1.5rem; line-height: 1.6; opacity: 0.95;">
                            ${primaryStage.workplaceScenario}
                        </p>
                    </div>
                    
                    <div class="result-section result-section-animated" style="animation-delay: 1.2s;">
                        <h3>Common Behaviors You May Recognize</h3>
                        <ul class="top-items">
                            ${primaryStage.behaviorExamples.slice(0, 4).map(example => 
                                `<li>${example}</li>`
                            ).join('')}
                        </ul>
                    </div>
                    
                    <div class="result-section result-section-animated" style="animation-delay: 1.5s;">
                        <h3>The Hidden Cost</h3>
                        <div class="trap-warning">
                            ‚ö†Ô∏è ${primaryStage.trap}
                        </div>
                    </div>
                    
                    <div class="result-section result-section-animated" style="animation-delay: 1.8s;">
                        <h3>Your Development Path</h3>
                        <div class="shift-emphasis">
                            üí° ${primaryStage.shift}
                        </div>
                    </div>
                    
                    <div class="result-section result-section-animated" style="animation-delay: 2.1s;">
                        <h3>Recommended Reading</h3>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1.25rem; border-radius: 12px; border-left: 3px solid #ff8f1c;">
                            <h4 style="margin-bottom: 0.5rem; font-size: 1.1rem;">
                                <a href="${primaryStage.suggestedReading.url}" target="_blank" style="color: #ff8f1c; text-decoration: none; border-bottom: 1px solid rgba(255, 143, 28, 0.3);">
                                    ${primaryStage.suggestedReading.title}
                                </a>
                            </h4>
                            <p style="font-size: 0.9rem; margin-bottom: 0.5rem; opacity: 0.8;">
                                ${primaryStage.suggestedReading.source}
                            </p>
                            <p style="font-size: 0.95rem; line-height: 1.5; opacity: 0.9;">
                                ${primaryStage.suggestedReading.description}
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            // Secondary stage card (if not tied)
            if (!results.isTie) {
                resultsContent += `
                    <div class="stage-card glass-card stage-card-animated" style="animation-delay: 2.4s;">
                        <div class="stage-header">
                            <h2 class="stage-title">Secondary Area: ${secondaryStage.displayName}</h2>
                            <div class="score-display">
                                <span class="stage-badge ${results.secondary.strength}">
                                    ${results.secondary.strength.toUpperCase()} ${results.secondary.score}/${results.secondary.maxScore}
                                </span>
                            </div>
                        </div>
                        
                        <p class="stage-description">${secondaryStage.definition}</p>
                        
                        <div class="result-section result-section-animated" style="animation-delay: 2.7s;">
                            <h3>Secondary Insights</h3>
                            <p>While your primary focus should be on ${primaryStage.displayName}, 
                               be aware that ${secondaryStage.displayName} tendencies may also influence your leadership style.</p>
                            <div class="trap-warning" style="margin-top: 1rem;">
                                ‚ö†Ô∏è ${secondaryStage.trap}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Action buttons
            resultsContent += `
                <div class="action-buttons action-buttons-animated" style="animation-delay: 3s;">
                    <button class="btn btn-secondary" onclick="copyResults()">
                        <span>üìã</span>
                        <span>Copy Results</span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetAssessment()">
                        <span>üîÑ</span>
                        <span>Reset</span>
                    </button>
                </div>
            `;
            
            // Add wrapper div and store in hidden div
            html += `<div id="resultsContent" style="display: none;">${resultsContent}</div>`;
            html += '</div>';
            
            resultsPanel.innerHTML = html;
            resultsPanel.style.display = 'block';
            
            // Smooth scroll to results with a slight delay
            setTimeout(() => {
                resultsPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
            
            // Store results for export
            window.currentResults = results;
        }
        
        // Function to show results after interpretation guide
        function showResults() {
            const guide = document.querySelector('.interpretation-guide');
            const content = document.getElementById('resultsContent');
            
            if (guide) {
                guide.style.display = 'none';
            }
            
            if (content) {
                content.style.display = 'block';
                // Re-trigger animations
                const animatedElements = content.querySelectorAll('.stage-card-animated, .strength-animated, .result-section-animated, .action-buttons-animated');
                animatedElements.forEach(el => {
                    el.style.animation = 'none';
                    el.offsetHeight; // Trigger reflow
                    el.style.animation = '';
                });
            }
        }
        
        // Copy results to clipboard in formatted text
        function copyResults() {
            if (!window.currentResults) return;
            
            const results = window.currentResults;
            const primaryStage = stages[results.primary.stage];
            const secondaryStage = stages[results.secondary.stage];
            
            // Calculate percentages for distribution
            const totalScore = Object.values(results.scores).reduce((sum, score) => sum + score, 0);
            const distribution = Object.entries(results.scores)
                .map(([stage, score]) => {
                    const percentage = Math.round((score / totalScore) * 100);
                    return `  ‚Ä¢ ${stages[stage].displayName}: ${percentage}%`;
                })
                .join('\n');
            
            let text = `LEADERSHIP LOOP SELF-DIAGNOSTIC RESULTS
Generated: ${new Date().toLocaleString()}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
LEADERSHIP PROFILE DISTRIBUTION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${distribution}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PRIMARY FOCUS AREA: ${results.primary.stage.toUpperCase()}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Strength Level: ${results.primary.strength} (${results.primary.score}/${results.primary.maxScore})
Definition: ${primaryStage.definition}

WHAT THIS LOOKS LIKE:
${primaryStage.workplaceScenario}

COMMON BEHAVIORS YOU MAY RECOGNIZE:
${primaryStage.behaviorExamples.slice(0, 4).map((example, i) => `  ${i + 1}. ${example}`).join('\n')}

‚ö†Ô∏è THE HIDDEN COST:
${primaryStage.trap}

üí° YOUR DEVELOPMENT PATH:
${primaryStage.shift}

üìö RECOMMENDED READING:
"${primaryStage.suggestedReading.title}"
Source: ${primaryStage.suggestedReading.source}
Link: ${primaryStage.suggestedReading.url}
${primaryStage.suggestedReading.description}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
SECONDARY AREA: ${results.secondary.stage.toUpperCase()}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Strength Level: ${results.secondary.strength} (${results.secondary.score}/${results.secondary.maxScore})
Definition: ${secondaryStage.definition}

WORKPLACE SCENARIO:
${secondaryStage.workplaceScenario}

While your primary focus should be on ${results.primary.stage},
be aware that ${results.secondary.stage} tendencies may also
influence your leadership style.

‚ö†Ô∏è SECONDARY RISK:
${secondaryStage.trap}`;
            
            // Add strengths if present
            if (results.strengths && results.strengths.length > 0) {
                text += `

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
YOUR LEADERSHIP STRENGTHS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
These areas show mature leadership practices:
${results.strengths.map(s => `  ‚Ä¢ ${s.displayName}: ${s.description}`).join('\n')}`;
            }
            
            text += `

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
NEXT STEPS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
1. Review the workplace scenarios - do they resonate?
2. Notice when you exhibit the common behaviors listed
3. Focus on your development path for the primary stage
4. Build awareness of secondary patterns
5. Practice new approaches in low-stakes situations first
6. Reassess in 60-90 days to track progress

Assessment completed on ${new Date().toLocaleDateString()}`;
            
            // Copy to clipboard
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                const btn = event.target.closest('.btn');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<span>‚úì</span><span>Copied!</span>';
                btn.style.background = 'linear-gradient(135deg, #323e48, #5a6670)';
                
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('Failed to copy. Please try again or select the text manually.');
            });
        }

        // Create visual chart
        function createChart(scores) {
            // Calculate total score across all stages
            const totalScore = Object.values(scores).reduce((sum, score) => sum + score, 0);
            
            // Convert scores to exact percentages
            const entries = Object.entries(scores).map(([stage, score]) => ({
                stage: stages[stage].displayName,
                score: score,
                exactPercentage: (score / totalScore) * 100
            }));
            
            // Sort entries by score for better visualization
            entries.sort((a, b) => b.score - a.score);
            
            // Smart rounding to ensure sum equals 100
            const roundedPercentages = smartRound(entries.map(e => e.exactPercentage));
            entries.forEach((entry, index) => {
                entry.percentage = roundedPercentages[index];
            });
            
            // Create pie chart data
            const colors = ['#ff8f1c', '#ed2024', '#ff6b6b', '#323e48', '#ffb366', '#5a6670'];
            let cumulativePercentage = 0;
            
            const pieSegments = entries.map((entry, index) => {
                const startAngle = (cumulativePercentage * 360) / 100;
                const endAngle = ((cumulativePercentage + entry.percentage) * 360) / 100;
                const midAngle = (startAngle + endAngle) / 2;
                cumulativePercentage += entry.percentage;
                return {
                    ...entry,
                    startAngle,
                    endAngle,
                    midAngle,
                    color: colors[index % colors.length]
                };
            });
            
            return `
                <div class="chart-container glass-card">
                    <h3>Your Leadership Profile Distribution</h3>
                    
                    <div class="charts-wrapper" style="display: flex; gap: 4rem; align-items: center; justify-content: center; flex-wrap: wrap; margin: 3rem 0;">
                        
                        <!-- Pie Chart -->
                        <div class="pie-chart-container" style="position: relative; width: 400px; height: 400px;">
                            <svg width="400" height="400" viewBox="0 0 400 400">
                                ${pieSegments.map((segment, index) => {
                                    // Convert angles to radians
                                    const startRad = (segment.startAngle - 90) * Math.PI / 180;
                                    const endRad = (segment.endAngle - 90) * Math.PI / 180;
                                    const midRad = (segment.midAngle - 90) * Math.PI / 180;
                                    
                                    const largeArcFlag = segment.endAngle - segment.startAngle > 180 ? 1 : 0;
                                    
                                    // Outer circle points
                                    const startX = 200 + 160 * Math.cos(startRad);
                                    const startY = 200 + 160 * Math.sin(startRad);
                                    const endX = 200 + 160 * Math.cos(endRad);
                                    const endY = 200 + 160 * Math.sin(endRad);
                                    
                                    // Calculate label position (middle of segment)
                                    const labelRadius = 120;
                                    const labelX = 200 + labelRadius * Math.cos(midRad);
                                    const labelY = 200 + labelRadius * Math.sin(midRad);
                                    
                                    return `
                                        <g>
                                            <path d="M 200 200 L ${startX} ${startY} A 160 160 0 ${largeArcFlag} 1 ${endX} ${endY} Z"
                                                  fill="${segment.color}"
                                                  stroke="#000000"
                                                  stroke-width="1"
                                                  opacity="0.9"
                                                  class="pie-segment"
                                                  style="animation: pieGrow 0.8s ease-out ${index * 0.1}s backwards;">
                                                <title>${segment.stage}: ${segment.percentage}%</title>
                                            </path>
                                            <!-- Percentage label -->
                                            ${segment.percentage > 5 ? `
                                            <text x="${labelX}" y="${labelY}" 
                                                  text-anchor="middle" 
                                                  dominant-baseline="middle"
                                                  fill="white" 
                                                  font-size="18" 
                                                  font-weight="bold"
                                                  style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
                                                         pointer-events: none;
                                                         animation: fadeIn 1s ease-out ${index * 0.1 + 0.5}s backwards;">
                                                ${segment.percentage}%
                                            </text>
                                            ` : ''}
                                        </g>
                                    `;
                                }).join('')}
                                
                                <!-- Center circle for donut effect -->
                                <circle cx="200" cy="200" r="80" fill="#000000" stroke="rgba(255, 255, 255, 0.1)" stroke-width="2"/>
                                
                                <!-- Center text -->
                                <text x="200" y="200" text-anchor="middle" dominant-baseline="middle" 
                                      fill="white" font-size="24" font-weight="bold">
                                    100%
                                </text>
                            </svg>
                            
                            <style>
                                @keyframes pieGrow {
                                    from {
                                        transform: scale(0);
                                        transform-origin: center;
                                        opacity: 0;
                                    }
                                    to {
                                        transform: scale(1);
                                        transform-origin: center;
                                        opacity: 0.9;
                                    }
                                }
                                @keyframes fadeIn {
                                    from { opacity: 0; }
                                    to { opacity: 1; }
                                }
                                .pie-segment:hover {
                                    opacity: 1 !important;
                                    filter: brightness(1.2);
                                    cursor: pointer;
                                }
                            </style>
                        </div>
                        
                        <!-- Legend Box -->
                        <div class="chart-legend" style="display: flex; flex-direction: column; gap: 1rem; min-width: 200px;">
                            ${pieSegments.map((segment, index) => `
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <div style="width: 24px; height: 24px; background: ${segment.color}; border-radius: 4px; flex-shrink: 0;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 1rem; font-weight: 600; line-height: 1.2;">${segment.stage.split('(')[0].trim()}</div>
                                        <div style="font-size: 0.9rem; opacity: 0.7;">${segment.percentage}%</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Smart rounding function to ensure percentages sum to exactly 100
        function smartRound(percentages) {
            const rounded = percentages.map(Math.floor);
            let sum = rounded.reduce((a, b) => a + b, 0);
            
            // Calculate the decimal parts and their indices
            const decimals = percentages.map((val, idx) => ({
                index: idx,
                decimal: val - Math.floor(val)
            }));
            
            // Sort by decimal part (descending)
            decimals.sort((a, b) => b.decimal - a.decimal);
            
            // Add 1 to the items with the largest decimal parts until we reach 100
            let i = 0;
            while (sum < 100) {
                rounded[decimals[i].index]++;
                sum++;
                i++;
            }
            
            return rounded;
        }

        // Reset assessment
        function resetAssessment() {
            if (confirm('Are you sure you want to reset the assessment? This will clear all your responses.')) {
                localStorage.removeItem('leadershipAssessmentRevised');
                assessmentData = {};
                forcedChoiceData = {};
                location.reload();
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('leadershipAssessmentRevised', JSON.stringify({
                assessmentData,
                forcedChoiceData,
                itemOrder: itemOrder.map(item => ({
                    text: item.text,
                    stage: item.stage,
                    reverse: item.reverse,
                    originalIndex: item.originalIndex,
                    id: item.id
                }))
            }));
        }

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('leadershipAssessmentRevised');
            if (saved) {
                const data = JSON.parse(saved);
                assessmentData = data.assessmentData || {};
                forcedChoiceData = data.forcedChoiceData || {};
                
                // Restore form values
                setTimeout(() => {
                    // Restore Likert values
                    Object.entries(assessmentData).forEach(([index, data]) => {
                        const radio = document.getElementById(`item-${index}-${data.raw}`);
                        if (radio) {
                            radio.checked = true;
                        }
                    });
                    
                    // Restore forced-choice values
                    Object.entries(forcedChoiceData).forEach(([index, value]) => {
                        const radio = document.querySelector(`input[name="forced-${index}"][value="${value}"]`);
                        if (radio) {
                            radio.checked = true;
                        }
                    });
                    
                    updateProgress();
                }, 100);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
